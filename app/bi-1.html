<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Market Summary</title>
  <style>
    body {
      background: #191c23;
      color: #e6e6e6;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      box-sizing: border-box;
    }
    .container {
      max-width: 800px;
      margin: 48px auto;
      background: #22242e;
      border-radius: 18px;
      box-shadow: 0 4px 32px 0 rgba(0,0,0,0.45);
      padding: 36px 32px 28px 32px;
    }
    .summary-title {
      color: #32b1ff;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 28px;
      letter-spacing: 0.5px;
    }
    .news-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .news-card {
      background: #232532;
      border-radius: 12px;
      box-shadow: 0 2px 10px 0 rgba(0,0,0,0.13);
      padding: 18px 22px 14px 22px;
      border: 1.5px solid transparent;
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      justify-content: space-between;
      transition: 
        box-shadow 0.2s cubic-bezier(.4,2,.6,1),
        border 0.2s cubic-bezier(.4,2,.6,1),
        transform 0.18s cubic-bezier(.4,2,.6,1);
      cursor: pointer;
      min-height: 70px;
      position: relative;
      overflow: hidden;
    }
    .news-card:hover {
      box-shadow: 0 6px 32px 0 rgba(50,177,255,0.18), 0 2px 10px 0 rgba(0,0,0,0.13);
      border: 1.5px solid #32b1ff;
      transform: translateY(-2px) scale(1.012);
    }
    .news-content {
      flex: 1 1 auto;
      min-width: 0;
    }
    .news-title {
      font-size: 1.04rem;
      color: #fff;
      font-weight: 600;
      margin-bottom: 6px;
      line-height: 1.27;
      text-decoration: none;
      transition: color 0.2s;
      display: inline-block;
      word-break: break-word;
    }
    .news-card:hover .news-title {
      color: #32b1ff;
      text-decoration: underline;
    }
    .news-desc {
      font-size: 0.97rem;
      color: #b6b9c7;
      margin-bottom: 0;
      line-height: 1.5;
      white-space: pre-line;
      text-overflow: ellipsis;
      overflow: hidden;
      max-height: 3.2em;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .news-meta {
      flex: 0 0 auto;
      margin-left: 22px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: flex-start;
      min-width: 120px;
    }
    .meta-source {
      color: #b1b5c3;
      font-size: 0.97rem;
      font-weight: 500;
      margin-bottom: 2px;
      text-align: right;
      white-space: nowrap;
    }
    .meta-time {
      color: #7e8597;
      font-size: 0.92rem;
      text-align: right;
      white-space: nowrap;
    }
    .loading, .error {
      text-align: center;
      color: #32b1ff;
      font-size: 1.1rem;
      margin-top: 24px;
    }
    .error {
      color: #ff4b6e;
    }
    @media (max-width: 600px) {
      .container {
        padding: 12px 4px 8px 4px;
      }
      .news-card {
        flex-direction: column;
        padding: 14px 10px 10px 10px;
      }
      .news-meta {
        margin-left: 0;
        margin-top: 8px;
        align-items: flex-start;
        min-width: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="summary-title">Market Summary</div>
    <div class="news-list" id="news-list">
      <!-- News cards will be injected here -->
    </div>
    <div class="loading" id="loading">Đang tải tin tức...</div>
    <div class="error" id="error" style="display:none"></div>
  </div>
  <script>
    // === CONFIG ===
    const API_KEY = '071e2a569c784e639f72de8f095d702c';
    const QUERY = 'AAPL OR NVDA OR TSLA OR META OR MSFT';
    const MAX_ARTICLES = 10;

    // Nếu chạy trên browser, bạn cần proxy CORS:
    const USE_CORS_PROXY = true;
    const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/';

    const ENDPOINT = 
      (USE_CORS_PROXY ? CORS_PROXY : '') +
      `https://newsapi.org/v2/everything?q=${encodeURIComponent(QUERY)}&language=en&sortBy=publishedAt&pageSize=${MAX_ARTICLES}&apiKey=${API_KEY}`;

    function timeAgo(dateString) {
      const now = new Date();
      const date = new Date(dateString);
      const seconds = Math.floor((now - date) / 1000);
      if (seconds < 60) return `${seconds} seconds ago`;
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes} minutes ago`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours} hours ago`;
      const days = Math.floor(hours / 24);
      return `${days} days ago`;
    }

    function createNewsCard(article) {
      const card = document.createElement('div');
      card.className = 'news-card';
      card.onclick = () => { if(article.url) window.open(article.url, '_blank'); };

      const content = document.createElement('div');
      content.className = 'news-content';

      const title = document.createElement('a');
      title.className = 'news-title';
      title.href = article.url;
      title.target = '_blank';
      title.rel = 'noopener noreferrer';
      title.textContent = article.title;

      const desc = document.createElement('div');
      desc.className = 'news-desc';
      desc.textContent = article.description || '';

      content.appendChild(title);
      if (article.description) content.appendChild(desc);

      const meta = document.createElement('div');
      meta.className = 'news-meta';

      const source = document.createElement('div');
      source.className = 'meta-source';
      source.textContent = article.source && article.source.name ? article.source.name : 'Unknown';

      const time = document.createElement('div');
      time.className = 'meta-time';
      time.textContent = article.publishedAt ? timeAgo(article.publishedAt) : '';

      meta.appendChild(source);
      meta.appendChild(time);

      card.appendChild(content);
      card.appendChild(meta);

      return card;
    }

    async function fetchNews() {
      const newsList = document.getElementById('news-list');
      const loading = document.getElementById('loading');
      const errorDiv = document.getElementById('error');
      loading.style.display = '';
      errorDiv.style.display = 'none';
      newsList.innerHTML = '';

      try {
        const res = await fetch(ENDPOINT);
        if (!res.ok) throw new Error('Network error');
        const data = await res.json();
        if (data.status !== "ok") throw new Error(data.message || "API error");
        loading.style.display = 'none';

        if (!data.articles || !data.articles.length) {
          newsList.innerHTML = '<div class="error">Không có tin tức nào.</div>';
          return;
        }

        data.articles.forEach(article => {
          newsList.appendChild(createNewsCard(article));
        });
      } catch (err) {
        loading.style.display = 'none';
        errorDiv.style.display = '';
        errorDiv.textContent = 'Không tải được tin tức. Có thể do CORS hoặc API key. Xem console để biết chi tiết!';
        console.error(err);
      }
    }

    fetchNews();
  </script>
</body>
</html>